version: 2

models:
  - name: fct_notion_security_questionnaires
    description: >
      Tracking of submissions of security questionnaire requests from the sales
      team(s) to the security team.
    tests:
      # If this warns, the offending row(s) SFDC URL parsing is not returning an SFDC ID
      - dbt_utils.expression_is_true:
          expression: len(salesforce_opportunity_id) = 18 or salesforce_opportunity_id = 'Not SFDC Opp ID'
          config:
            severity: warn
    columns:
      - name: security_questionnaire_id
        tests:
          - not_null
          - unique
      - name: salesforce_opportunity_id
        tests:
          # If this warns, the offending row(s) do not have parseable SFDC URLs
          - not_null:
              config:
                where: salesforce_opportunity_url is not null
                severity: warn