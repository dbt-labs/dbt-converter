
version: 2

models:
  - name: int__invoice_line_items_unioned
    description: >
      This is an intermediate model that unions Salesforce and Quickbooks line items
      and Stripe _invoices_ as we don't really look at Stripe invoice line items.
    columns:
      - name: invoice_line_id
        description: '{{ doc("invoice_line_id") }}'
        tests:
          - unique
          - not_null

      - name: customer_id
        description: '{{ doc("customer_id") }}'

      - name: customer_id_type
        description: '{{ doc("customer_id_type") }}'

      - name: source
        description: >
          The upstream source of the relevant invoice line item.

      - name: invoice_id
        description: '{{ doc("invoice_id") }}'

      - name: stripe_customer_id
        description: '{{ doc("stripe_customer_id") }}'

      - name: salesforce_account_id
        description: '{{ doc("sfdc_account_id") }}'

      - name: quickbooks_customer_id
        description: '{{ doc("quickbooks_customer_id") }}'

      - name: sfdc_order_item_id
        description: '{{ doc("sfdc_order_item_id") }}'

      - name: customer_name
        description: '{{ doc("customer_name") }}'

      - name: invoice_number
        description: '{{ doc("invoice_number") }}'

      - name: description
        description: '{{ doc("product_description") }}'

      - name: product_name
        description: '{{ doc("product_name") }}'

      - name: transaction_type
        description: '{{ doc("invoice_item_transaction_type") }}'

      - name: amount
        description: '{{ doc("invoice_item_pretax_amount") }}'

      - name: tax_amount
        description: '{{ doc("invoice_item_tax_amount") }}'

      - name: start_date
        description: '{{ doc("invoice_item_start_date") }}'

      - name: end_date
        description: '{{ doc("invoice_item_end_date") }}'

      - name: invoice_date
        description: '{{ doc("invoice_issue_date") }}'

      - name: created_at
        description: '{{ doc("invoice_created_at") }}'

      - name: billing_finance_period_start_date
        description: '{{ doc("finance_period_start_date") }}'

      - name: invoice_status
        description: '{{ doc("invoice_status") }}'

      - name: is_open_invoice
        description: '{{ doc("is_open_invoice") }}'

      - name: is_paid_invoice
        description: '{{ doc("is_paid_invoice") }}'

      - name: is_professional_services_item
        description: '{{ doc("is_professional_services_item") }}'

      - name: is_sales_tax_line_item
        description: '{{ doc("is_sales_tax_line_item") }}'

  - name: int__quickbooks_invoice_lines
    description: >
      This is a utils model that parses out the `start_date` and `end_date` for enterprise invoices.
      After our migration from Salesforce CPQ (7/21), this model is no longer actively updated.
    columns:
      - name: invoice_line_id
        tests:
          - unique

  - name: int__salesforce_invoice_lines
    columns:
      - name: invoice_line_id
        tests:
          - unique
          - not_null
      - name: subtotal
        description: '{{ doc("invoicing_subtotal") }}'
      - name: sfdc_billing_finance_book_id
        description: '{{ doc("sfdc_billing_finance_book_id") }}'
      - name: sfdc_billing_finance_period_id
        description: '{{ doc("sfdc_billing_finance_period_id") }}'
      - name: sfdc_billing_gl_rule_id
        description: '{{ doc("sfdc_billing_gl_rule_id") }}'
      - name: sfdc_billing_rule_id
        description: '{{ doc("sfdc_billing_rule_id") }}'
      - name: sfdc_billing_treatment_id
        description: '{{ doc("sfdc_billing_treatment_id") }}'
      - name: sfdc_legal_entity_reference_id
        description: '{{ doc("sfdc_legal_entity_reference_id") }}'
      - name: sfdc_legal_entity_id
        description: '{{ doc("sfdc_legal_entity_id") }}'
      - name: sfdc_tax_gl_rule_id
        description: '{{ doc("sfdc_tax_gl_rule_id") }}'
      - name: sfdc_tax_gl_treatment_id
        description: '{{ doc("sfdc_tax_gl_treatment_id") }}'
      - name: sfdc_tax_rule_id
        description: '{{ doc("sfdc_tax_rule_id") }}'
      - name: sfdc_tax_treatment_id
        description: '{{ doc("sfdc_tax_treatment_id") }}'
      - name: billing_finance_period_start_date
        description: '{{ doc("finance_period_start_date") }}'