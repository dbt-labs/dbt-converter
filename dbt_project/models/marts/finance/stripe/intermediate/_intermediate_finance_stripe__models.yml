version: 2

models:
  - name: int__stripe_subscription_changes_corrections
    description: >
      This model corrects the subscription charges for when we changed subscription plans mid-cycle.
      These changes occured on 14 Jan 2020 (went from basic subscription + extra seats to charging by developer seats)
      and 1 Feb 2023 (went from $50 to $100/seat). When we change the plan types mid-cycle, then we only charge them
      during their next usage cycle. We also flag for when a subscription event changes a customer's ARR. This is used
      downstream in `fct_stripe_subscription_events` which feeds into our ARR model: `fct_cloud_subscription_transactions`.
    columns:
      - name: unique_id
        tests:
          - unique
          - not_null
      - name: cost_change_comment
        description: '{{ doc("cost_change_comment") }}'
      - name: price
        description: '{{ doc("price") }}'
      - name: cost_change
        description: '{{ doc("cost_change") }}'
      - name: subscription_change_type
        description: '{{ doc("subscription_change_type") }}'
      - name: is_subscription_change_event
        description: '{{ doc("is_subscription_change_event") }}'

  - name: int__stripe_subscription_changes_joined
    description: >
      This model enriches subscription events with invoice, customer, and subscription metadata.
    columns:
      - name: unique_id
        tests:
          - unique
          - not_null
      - name: cost_change_comment
        description: '{{ doc("cost_change_comment") }}'
      - name: price
        description: '{{ doc("price") }}'
      - name: cost_change
        description: '{{ doc("cost_change") }}'
      - name: subscription_change_type
        description: '{{ doc("subscription_change_type") }}'
      - name: is_subscription_change_event
        description: '{{ doc("is_subscription_change_event") }}'