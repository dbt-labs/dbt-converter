version: 2

models:
  - name: int_adp_worker_timeseries
    description: >
      Historical ADP data that is ref'd in `dim_employees` is slowly changing
      dimension type 2. This model collapses those datasets into a single
      timeseries for ease of use in `dim_employees`. See
      https://docs.getdbt.com/blog/joining-snapshot-complexity for more details
      on the modeling approach used.

      This model captures the *final* state of the employee for a day.
      
  - name: int_dei_align_adp_values
    description: >
      Remapping of racial identity values provided by employees in ADP into EEO-style and DEI-style classifications.
    columns:
      - name: worker_id
        tests:
          - unique
      - name: gender_identity
        meta:
          masking_policy: dei_string
      - name: ethnicity
        meta:
          masking_policy: dei_string
      - name: age_bucket
        meta:
          masking_policy: dei_string
      - name: dei_ethnicity_and_race
        meta:
          masking_policy: dei_string
      - name: eeo_racial_identity
        meta:
          masking_policy: dei_string

  - name: int_dei_align_diversity_form_values
    description: >
      Remapping of racial identity values provided by employees in the [Diversity Survey Form](https://docs.google.com/forms/d/e/1FAIpQLSdAkFNJVZ1gDjQbPlSmk-N7zsntIaF_JSi-S5d_AsTUKet1IA/viewform) 
      into EEO-style and DEI-style classifications.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - sheet_row_id
            - email_address
    columns:
      - name: email_address
        meta:
          masking_policy: dei_string
      - name: submitted_at
        meta:
          masking_policy: dei_date

  - name: int_dei_align_person_attributes
    description: >
      Align demographic attributes across ADP and [survey data](https://docs.google.com/forms/d/e/1FAIpQLSdAkFNJVZ1gDjQbPlSmk-N7zsntIaF_JSi-S5d_AsTUKet1IA/viewform). 
      When data is available from both sources, the DEI coordinator informed the order we apply preference.
    columns:
      - name: worker_id
        tests:
          - not_null
          - unique
      - name: gender_identity
        description: Sourced from survey data when available, falling back to ADP data. Every employee is guaranteed to have a value (even if that value is "Not Specified").
        tests:
          - accepted_values:
              # If new values are added, Looker needs to be updated to handle the automatically-generated columns in rpt_demographics_by_department
              values: ['Man', 'Woman', 'Non-binary or agender', 'Not Specified']
          - not_null
      - name: ethnicity
        description: Sourced solely from ADP.
        tests:
          - accepted_values:
              # If new values are added, Looker needs to be updated to handle the automatically-generated columns in rpt_demographics_by_department
              values: ["Hispanic or Latino", "Not Hispanic or Latino"]
      - name: eeo_racial_identity
        description: Sourced from survey data when available, falling back to ADP data. Self-reported racial identities are mapped back to the EEO terms using [this sheet](https://docs.google.com/spreadsheets/d/10ZbUtLs1BMUKlbqSj9S-0iuG7KNSOSfiq8A-FBnHKF8/edit#gid=0).
        tests:
          - accepted_values:
              # If new values are added, Looker needs to be updated to handle the automatically-generated columns in rpt_demographics_by_department
              values: ['Hispanic or Latino', 'Two or more races (Not Hispanic or Latino)', 'White', 'Asian', 'Black or African American', 'Prefer not to say']
      - name: dei_ethnicity_and_race
        description: Sourced from survey data when available, falling back to ADP data. Every employee is guaranteed to have a value (even if that value is "Not Specified").
        tests:
          - accepted_values:
              # If new values are added, Looker needs to be updated to handle the automatically-generated columns in rpt_demographics_by_department
              values: ['Hispanic or Latine', 'Middle Eastern or North African', 'White', 'Asian', 'Black or African American', 'Multiracial/ethnic (Not Hispanic or Latine)', 'Prefer not to say', 'Not Specified']
          - not_null
      - name: age_bucket
        description: Sourced solely from ADP data. Every employee is guaranteed to have a value.
        tests:
          - accepted_values:
              # If new values are added, Looker needs to be updated to handle the automatically-generated columns in rpt_demographics_by_department
              values: ['18 to 24', '25 to 34', '35 to 44', '45 to 54', '55 to 64', '65+']
          - not_null
      - name: disability
        description: Sourced from survey data when available, falling back to ADP data.
        tests:
          - accepted_values:
              values: ['Yes', 'No', 'Prefer not to say']
      - name: caregiver
        description: Sourced solely from survey data.
        tests:
          - accepted_values:
              values: ['Yes', 'No', 'Prefer not to say']
      - name: lgbtqia
        description: Sourced solely from survey data.
        tests:
          - accepted_values:
              values: ['LGBTQIA', 'Not LGBTQIA', 'Prefer not to say']
      - name: highest_education
        description: Sourced solely from survey data.
        tests:
          - accepted_values:
              name: dei_highest_education_accepted_values
              values: ["High school diploma, GED, or A-Levels", "Some college credit, no degree", "Bachelor''s Degree", "Associate''s Degree", "Bachelor''s Degree", "Master''s Degree", "Professional Degree", "Doctorate", "Trade/technical/vocational training", "Not specified"]

  - name: int_greenhouse_users
    description: All User ID, Name, and Email information for Greenhouse Users
    columns:
      - name: greenhouse_user_id
        tests:
          - unique
          - not_null
 
  - name: int_greenhouse_job_departments
    description: >
      L0 and L1 Job Departments by Job ID
      L0 is the most granular team designation for a given team, L1 is 1 level less granular
      Example: L0 = Revenue,  L1 = Sales
    columns:
      - name: job_id
        tests:
          - unique
          - not_null

  - name: int_greenhouse_job_offices
    description: Job office name and location for all jobs
    columns:
      - name: job_id
        tests:
          - unique
          - not_null

  - name: int_greenhouse_job_applications
    description: Job applications with all associated jobs
    columns:
      - name: application_id
        tests:
          - unique
          - not_null

  - name: int_greenhouse_jobs
    description: All jobs created in Greenhouse. One job to many job_openings
    columns:
      - name: job_id
        tests:
          - unique
          - not_null

  - name: int_adp_locations
    description: blank
    columns:
      - name: location_id
        tests:
          - unique
          - not_null

  - name: int_adp_workers_with_locations
    description: All worker assignments and locations in ADP
    columns:
      - name: worker_assignment_id
        tests:
          - unique
          - not_null

  - name: int_organizational_units_with_workers
    description: >
      TO BE DEPRECATED IN FOLLOW UP PR - contact Elize w/ questions
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_assignment_id
            - worker_id
            - organizational_level_name

  - name: int_adp_person_history
    description: Added country codes to legal address for modeling in dim_employees
    columns:
      - name: worker_id
        tests:
          - not_null
          - unique

  - name: int_greenhouse_hiring_managers
    description: Hiring Manager to user ID mapping
    columns:
      - name: job_hiring_team_member_id
        tests:
          - not_null
          - unique
  
  - name: int_adp_worker_reports_to_name
    description: A timeseries of worker to manager mapping including the managers current preferred first name. One record per
      combination of worker_assignment_id, worker_id per timeframe. Snapshotting of this dataset began
      January 15, 2023. 
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_id
            - worker_assignment_id
            - reports_to_valid_from
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_id
            - worker_assignment_id
            - is_first_reports_to
          config:
            where: "is_first_reports_to = true"
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_id
            - worker_assignment_id
            - is_current_reports_to
          config:
            where: "is_current_reports_to = true"
  - name: int_adp_worker_base_remuneration_snapshot_adj
    description: >
      A history of a given worker's remuneration records, adjusted for exceptions found 
      in adp_worker_base_remuneration_snapshot_exceptions.csv.
    columns:
      - name: annual_rate_amount_amount_value
        meta:
          masking_policy: finance_number
  - name: int_adp_worker_base_remuneration
    description: Timeseries of worker_id to base remuneration annual amount.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_assignment_id
            - worker_id
            - annual_amount_valid_from
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_assignment_id
            - worker_id
            - is_first_annual_amount
          config:
            where: "is_first_annual_amount = true"
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_assignment_id
            - worker_id
            - is_current_annual_amount
          config:
            where: "is_current_annual_amount = true"
    columns:
      - name: worker_id
        tests:
          - not_null
      - name: annual_amount
        meta:
          masking_policy: finance_number
      - name: annual_amount_valid_to
        meta:
          masking_policy: finance_date
      - name: annual_amount_valid_from
        meta:
          masking_policy: finance_date