version: 2

models:
    - name: int__customer_account_feedback
      description: >
      columns:
        - name: customer_id
          tests:
            - unique
            - not_null

    - name: int__customer_slack_activity
      description: >
        A summary of Slack activity for a dbt Cloud customer. This is tied by email address, and is summarized for all 
        users of that customer. dbt Labs employees are excluded from this table.
      columns:
        - name: customer_id
          tests:
            - unique
            - not_null

    - name: int__customer_health_calculations
      description: >
        This table contains all the intermediate calculations needed to score customer health. 
        Certain ratios are needed for customer health to score customer's in defined buckets.
      columns:
        - name: customer_id
          tests:
            - unique
            - not_null

    - name: int__customer_account_project
      description: >
        This table calculates metrics around their project, such as: Models Built, Project Growth.
      columns:
        - name: customer_id
          tests:
            - unique
            - not_null

    - name: int__customer_account_usage_activity
      description: >
        This table calculates IDE time engaged per account and MAUs with segmentations based on product.
      columns:
        - name: customer_id
          tests:
            - unique
            - not_null

    - name: int__customer_account_usage_cloud_runs
      description: >
        This table accounts for Cloud Run metrics for a given customer (i.e. Job Runs or IDE sessions)
      columns:
        - name: customer_id
          tests:
            - unique
            - not_null

    - name: int__customer_account_user_activity
      description: >
        This table calculates the number of days in the last 30 days that a user was active. 
        It is it's own model because the calcualtion is done at a different grain than other user activities. 
        This is a running total, but moving in reverse (i.e. 10 users were active 10 days, 15 users were active 9 days which includes the 10 users who were active 10 days)
      columns:
        - name: customer_id
          tests:
            - unique
            - not_null
        - name: plan
          description: '{{ doc("cloud_plan") }}'
        - name: plan_tier
          description: '{{ doc("cloud_plan_tier") }}'

    - name: int__customer_account_utilization_managed
      description: >
        This corrects the purchased seats to be based off of when the opportuntiy was closed
        and adjusts the end dates if the opportunity closed mid-service contract period
        for the previous won opportunity line items.
      columns:
        - name: opportunity_line_item_id
          tests:
            - unique
            - not_null


    - name: int__customer_account_utilization
      description: >
      columns:
        - name: customer_id
          tests:
            - unique
            - not_null

    - name: int__customer_account_hubspot_activity
      description: >
        This table is used to calculate the cumulative open rate of Hubspot emails for a Salesforce account. 
        It takes the unique number of deliveries and opens for each contact, aggregates them, and calculates the open rate from that.
      columns:
        - name: salesforce_account_id
          tests:
            - unique
            - not_null

    - name: int__customer_account_usage_core_runs
      description: >
        This table accounts for Core Run metrics for a given customer (i.e. Job Runs)
      columns:
        - name: customer_id
          tests:
            - unique
            - not_null
        - name: t7d_core_runs
          description: '{{ doc("core_run_metrics") }}'

        - name: prev_t7d_core_runs
          description: '{{ doc("core_run_metrics") }}'

        - name: t30d_core_runs
          description: '{{ doc("core_run_metrics") }}'

        - name: prev_t30d_core_runs
          description: '{{ doc("core_run_metrics") }}'

        - name: t90d_core_runs
          description: '{{ doc("core_run_metrics") }}'

        - name: t7d_core_runs_successful
          description: '{{ doc("core_run_metrics") }}'

        - name: prev_t7d_core_runs_successful
          description: '{{ doc("core_run_metrics") }}'

        - name: t30d_core_runs_successful
          description: '{{ doc("core_run_metrics") }}'

        - name: prev_t30d_core_runs_successful
          description: '{{ doc("core_run_metrics") }}'

        - name: t90d_core_runs_successful
          description: '{{ doc("core_run_metrics") }}'

        - name: t7d_core_runs_failed
          description: '{{ doc("core_run_metrics") }}'

        - name: prev_t7d_core_runs_failed
          description: '{{ doc("core_run_metrics") }}'

        - name: t30d_core_runs_failed
          description: '{{ doc("core_run_metrics") }}'

        - name: prev_t30d_core_runs_failed
          description: '{{ doc("core_run_metrics") }}'

        - name: t90d_core_runs_failed
          description: '{{ doc("core_run_metrics") }}'

        - name: t7d_core_runs_pct_change
          description: '{{ doc("core_run_metrics") }}'

        - name: t30d_core_runs_pct_change
          description: '{{ doc("core_run_metrics") }}'

        - name: t7d_core_runs_successful_pct_change
          description: '{{ doc("core_run_metrics") }}'

        - name: t30d_core_runs_successful_pct_change
          description: '{{ doc("core_run_metrics") }}'

        - name: t7d_core_runs_failed_pct_change
          description: '{{ doc("core_run_metrics") }}'

        - name: t30d_core_runs_failed_pct_change
          description: '{{ doc("core_run_metrics") }}'

