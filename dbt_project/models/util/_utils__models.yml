version: 2

models:
  - name: all_business_hours
    description: '{{ doc("all_business_hours") }}'
    columns:
      - name: date_hour
        tests:
          - not_null
          - unique

  - name: all_days
    columns:
      - name: date_day
        tests:
          - not_null
          - unique

  - name: all_months
    columns:
      - name: date_month
        tests:
          - not_null
          - unique

  - name: cloud_account_mappings
    description: '{{ doc("cloud_account_mappings") }}'
    columns:
      - name: account_id
        tests:
          - not_null
          - unique
      - name: is_primary_cloud_account
        description: '{{ doc("is_primary_cloud_account") }}'
      - name: is_paying_account
        description: "Boolean to indicate if this Cloud Account is currently or has ever paid us before."
      - name: is_internal_account
        description: "Boolean to indicate if a Salesforce Account is internal to dbt Labs."
      - name: plan
        description: '{{ doc("cloud_plan") }}'
      - name: plan_tier
        description: '{{ doc("cloud_plan_tier") }}'
      - name: is_current_paying_account
        description: "Boolean to indicate if this Cloud Account is currently paying us ."

  - name: country_to_region_mappings
    description: '{{ doc("country_to_region_mappings") }}'
    columns:
      - name: country_code
        description: The two digit country code associated with the `country_name`.
        tests:
          - not_null
      - name: country_name
        description: The name of the country.
        tests:
          - not_null
      - name: data_source
        description: >
          The source of country codes & names.
          There are currently two sources of data: ISO-3661 database and Clearbit.
      - name: region_category
        description: The region associated with the `country_code` and/or `country_name`.

  - name: marketing_campaign_mappings
    description: '{{ doc("marketing_campaign_mappings") }}'
    columns:
        - name: campaign_source_id
          description: A unique value for every campaign across each source.
          tests:
            - unique
            - not_null

        - name: parent_campaign_id
          description: The ID of the parent campaign a campaign is associated with. This is sourced from the Parent Campaign ID in Salesforce and Marketing Campaign ID in HubSpot. For other platforms, it is simply the campaign ID.
        
        - name: parent_campaign_name
          description: The name of the parent campaign a campaign is associated with. This is sourced from the Parent Campaign Name in Salesforce and a Marketing Campaign Name in HubSpot. For other platforms, it is simply the campaign name.

        - name: campaign_id
          description: The ID of the campaign.
        
        - name: campaign_name
          description: The name of the campaign.
        
        - name: data_source
          description: The platfrom the data is sourced from.

        - name: marketing_campaign_period
          description: >
            The period in which a marketing campaign was run.
            This is the value in the 1st position in our marketing campaign nomenclature: campaign-period_campaign-name_campaign-goal.
            This can be several different types of time periods, including year (yyyy), quarter-year (q#-yyyy), half-year (h#-yyyy), or evergreen.
        
        - name: marketing_campaign_name
          description: >
            The truncated name of the marketing campaign.
            This is the value in the 2nd position in our marketing campaign nomenclature: campaign-period_campaign-name_campaign-goal.
            This field is useful for looking at a campaign in totality, across different campaign periods and goals.
        
        - name: marketing_campaign_goal
          description: >
            The goal of the marketing campaign. 
            This is the value in the 3rd position in our marketing campaign nomenclature: campaign-period_campaign-name_campaign-goal.
            This can be one of three values: `awareness`, `conversion`, `retention`.

        - name: spend
          description: >
            The total amount spent on the campaign.
            Currently, this is coming from only Salesforce & advertising sources.
            This can be used to calculate metrics such as total spend, cost per new contact, cost per lead, and cost per opportunity.

  - name: single_tenant_mapping_unioned
    description: >
      This model contains the current state of the world for single-tenant mappings.
      If a single-tenant's base or alias url host, primary or secondary ips, or private link connections
      change, then this contains the versions that are currently used today. This model is used to populate
      the snapshots model and thus the `single_tenant_mappings` model in case any of these identifiers
      change over time. This is because when we record events (e.g. invocations, page views, etc), then
      whatever identifier is used at the time, we'll want to ensure that the historcial version is associated
      with the event.
    columns:
      - name: unique_id
        tests:
          - unique
          - not_null
      - name: mapping_value
        tests:
          - unique:
              config:
                where: "mapping_field_type in ('ip_address', 'url_host')"

  - name: single_tenant_mappings
    description: >
      This model is a select all from the snapshot table. We don't expect
      changes here but this will function as a gate to stop building further if
      this assumption is broken. This is critcial because changing the 
      assignment of urls or IPs will lead to serious data issues downstream.
      This also serves as a way to be able to properly match historical data
      for single tenant instances that might have been wound down.
    columns:
      - name: id
        tests:
          - unique
          - not_null
      - name: mapping_value
        tests:
          - unique