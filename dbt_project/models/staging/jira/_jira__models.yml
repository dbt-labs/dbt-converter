version: 2

models:
  - name: stg_jira__boards
    columns:
      - name: board_id
        tests:
          - unique
          - not_null

  - name: stg_jira__epics
    columns:
      - name: epic_id
        tests:
          - unique
          - not_null

  - name: stg_jira__field_options
    columns:
      - name: field_option_id
        tests:
          - unique
          - not_null

  - name: stg_jira__fields
    columns:
      - name: field_id
        tests:
          - unique
          - not_null

  - name: stg_jira__issue_field_histories
    description: Table of every value that each **custom non-array** (not multiselect) field has been set to.
    columns:
      - name: issue_field_history_id
        tests:
          - unique
          - not_null
      - name: field_id
        description: Foreign key referencing the ID of the `field` that was changed.
      - name: issue_id
        description: Foreign key referencing the ID of the `issue` whose field was updated.
      - name: updated_at
        description: Timestamp of when the issue field was set to this value.
      - name: field_value
        description: Content of the value of that the field was set to
      - name: is_latest_field_value
        description: Boolean (true/false) that tells if this is the most up-to-date value of the field for a given issue.

  - name: stg_jira__issue_field_multiselect_histories
    description: >
      Table of every value that each array-type (multiselect) field has been set to. Each row will pertain to **one** value.
    columns:
      - name: issue_field_multiselect_history_id
        description: The unique identifier. This is a hashed ID on the _fivetran_id and updated_at columns.
        tests:
          - unique
          - not_null
      - name: _fivetran_id 
        description: Fivetran-generated ID hashed on field, issue, and value.
      - name: issue_id
        description: Foreign key referencing the ID of the `issue` whose field was updated.
      - name: field_id
        description: Foreign key referencing the ID of the `field` that was changed.
      - name: field_value
        description: Content of the value of that the field was set to. 
      - name: updated_at
        description: Timestamp of when the issue field was updated to included this value.

  - name: stg_jira__issue_boards
    description: "Utils model that links an issue to their associated boards."
    columns:
      - name: issue_board_id
        description: "Surrogate key between the `issue_id` and the `board_id`. This is the primary key."
        tests:
          - unique
          - not_null

  - name: stg_jira__issue_epics
    description: "Utils model that links an issue to their associated epics."
    columns:
      - name: issue_epic_id
        description: "Surrogate key between the `issue_id` and the `epic_id`. This is the primary key."
        tests:
          - unique
          - not_null

  - name: stg_jira__issue_links
    description: >
      Table of relationships (links) created between issues. Issue links can include blockers, clones/duplicates, and general relationships.
    columns:
      - name: issue_link_id
        tests:
          - unique
          - not_null
      - name: issue_id
        description: Foreign key referencing the ID of the `issue` that is the subject of this relationship (the linker).
      - name: related_issue_id
        description: Foreign key referencing the ID of the `issue` that is the object of this relationship (the linkee).
      - name: related_issue_relationship
        description: The nature of the link between the two issues ("blocks", "is duplicated by", "relates to", etc.)

  - name: stg_jira__issue_types
    description: >
      Table containing information about issue types. Issue types can have identical names in different projects, but they may have 
      differing descriptions.
    columns:
      - name: issue_type_id 
        description: Unique ID of the issue type. 
        tests:
          - unique
          - not_null
      - name: description
        description: Project-level description given to the issue type.
      - name: issue_type_name
        description: Name of the issue type (ie Epic, Task, Subtask, any custom types)
      - name: is_subtask
        description: Boolean that is true if this type of issue is a subtask.

  - name: stg_jira__issues
    description: Table of all issues in your organization's Jira (captures soft deletes).
    columns:
      - name: issue_id
        description: Unique ID of the issue. 
        tests:
          - unique
          - not_null
      - name: assignee_user_id
        description: '{{ doc("jira_issue_assignee_user_id") }}'
      - name: created_at
        description: '{{ doc("jira_issue_created_at") }}'
      - name: creator_user_id
        description: '{{ doc("jira_issue_creator_user_id") }}'
      - name: issue_description
        description: '{{ doc("jira_issue_issue_description") }}'
      - name: due_date
        description: '{{ doc("jira_issue_due_date") }}'
      - name: environment
        description: '{{ doc("jira_issue_environment") }}'
      - name: issue_type_id
        description: '{{ doc("jira_issue_issue_type_id") }}'
      - name: issue_key
        description: '{{ doc("jira_issue_issue_key") }}'
      - name: original_estimate_seconds
        description: '{{ doc("jira_issue_original_estimate_seconds") }}'
      - name: parent_issue_id
        description: '{{ doc("jira_issue_parent_issue_id") }}'
      - name: priority_id
        description: '{{ doc("jira_issue_priority_id") }}'
      - name: project_id
        description: '{{ doc("jira_issue_project_id") }}'
      - name: remaining_estimate_seconds
        description: '{{ doc("jira_issue_remaining_estimate_seconds") }}'
      - name: reporter_user_id
        description: '{{ doc("jira_issue_reporter_user_id") }}'
      - name: resolution_id
        description: '{{ doc("jira_issue_resolution_id") }}'
      - name: resolved_at
        description: '{{ doc("jira_issue_resolved_at") }}'
      - name: status_id
        description: '{{ doc("jira_issue_status_id") }}'
      - name: status_changed_at
        description: '{{ doc("jira_issue_status_changed_at") }}'
      - name: issue_name
        description: '{{ doc("jira_issue_issue_name") }}'
      - name: time_spent_seconds
        description: '{{ doc("jira_issue_time_spent_seconds") }}'
      - name: updated_at
        description: '{{ doc("jira_issue_updated_at") }}'
      - name: work_ratio
        description: '{{ doc("jira_issue_work_ratio") }}'

  - name: stg_jira__priorities 
    description: Table of issue priority levels (global).
    columns:
      - name: priority_id
        description: Unique ID of the priority level.
        tests:
          - unique
          - not_null
      - name: priority_description
        description: Description of the priority level.
      - name: priority_name
        description: Name of the priority as it appears in the UI.

  - name: stg_jira__project_boards
    description: Table of all projects and their boards.
    columns:
      - name: project_board_id
        description: Unique ID of the project which is a surrogate key between `project_id` and `board_id`.
        tests:
          - unique
          - not_null

  - name: stg_jira__projects
    description: Table of all projects.
    columns:
      - name: project_id
        description: Unique ID of the project.
        tests:
          - unique
          - not_null
      - name: project_description
        description: Description of the project, if given.
      - name: project_key
        description: UI-facing ID of the project. This becomes the default prefix for tasks created within this project.
      - name: project_lead_user_id
        description: Foreign key referencing the ID of the `user` who leads this project.
      - name: project_name
        description: Title of the project. 
      - name: permission_scheme_id
        description: Foreign key referencing the ID of the `permission_scheme` that the project ascribes to. 
      - name: project_category_id
        description: Foreign key referencing the ID of the `project_category` that the project is associated with, if any.

  - name: stg_jira__resolutions
    description: Table storing the types of resolutions used by your organization.
    columns: 
      - name: resolution_id
        description: Unique ID of the resolution type.
        tests:
          - unique
          - not_null
      - name: resolution_description
        description: Description given to the resolution.
      - name: resolution_name 
        description: Display name of the resolution.

  - name: stg_jira__sprints
    description: Table of all sprints.
    columns:
      - name: sprint_id
        description: Unique ID of the sprint.
        tests:
          - unique
          - not_null
      - name: board_id
        description: Foreign key referencing the ID of the `board` that the sprint lives in.
      - name: completed_at
        description: Timestamp of when the sprint was completed.
      - name: ended_at
        description: Timestamp of when the sprint is planned to end.
      - name: sprint_name  
        description: Title of the sprint.
      - name: started_at
        description: Timestamp of when the sprint began. 

  - name: stg_jira__statuses
    description: Table of project-level statuses (which may have the same umbrella `status_category`).
    columns:
      - name: status_id
        description: Unique ID of the project status.
        tests:
          - unique
          - not_null
      - name: status_description
        description: >
          Description of the project status. Different projects may all have a status called "Backlog", but their definitions 
          of "backlog" may differ.
      - name: status_name
        description: Title of the status.
      - name: status_category_id
        description: Foreign key referencing the ID of the `status_category` that this project status falls under.

  - name: stg_jira__status_categories
    description: Table of umbrella status categories.
    columns:
      - name: status_category_id
        description: Unique ID of the status category.
        tests:
          - unique
          - not_null
      - name: status_category_name
        description: Title of the status category.

  - name: stg_jira__users
    description: Table of users associated with your organization.
    columns:
      - name: user_id  
        description: Unique ID of the user. 
        tests:
          - unique
          - not_null
      - name: email
        description: Email associated with the user acccount.
      - name: locale
        description: The Java locale of the user. 
      - name: user_display_name
        description: Name of the user as it appears in the UI.
      - name: time_zone
        description: The user's timezone, as defined in their settings.
      - name: username
        description: Account username.