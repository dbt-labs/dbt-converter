version: 2

models:
  - name: stg_adp__business_communications
    description: Work email and cell phone values.
    columns:
      - name: worker_id
        tests:
          - not_null
          - unique
  - name: stg_adp__organizational_units
    description: Departmental and business unit mapping.
    columns:
      - name: organizational_unit_id
        tests:
          - not_null
          - unique
      - name: organizational_level_name
        tests:
          - accepted_values:
              values: ['Department', 'Business Unit']
      - name: organizational_unit_name
        tests:
          - not_null
  - name: stg_adp__person_disability
    description: Employee disability identification.
    columns:
      - name: worker_id
        tests:
          - not_null
          - unique
      - name: disability
        meta:
          masking_policy: dei_string
  - name: stg_adp__person_history
    description: Employee personal data.
    columns:
      - name: worker_id
        tests:
          - not_null
          - unique
      - name: age_bucket
        meta:
          masking_policy: dei_string
        # tests:
        #   - not_null
      - name: death_date
        meta:
          masking_policy: finance_date
      - name: ethnicity
        meta:
          masking_policy: dei_string
      - name: gender_identity
        meta:
          masking_policy: dei_string
      - name: legal_first_name
        meta:
          masking_policy: finance_string
      - name: legal_last_name
        meta:
          masking_policy: finance_string
      - name: legal_name
        meta:
          masking_policy: finance_string
      - name: racial_identity
        meta:
          masking_policy: dei_string
  - name: stg_adp__work_assignment_history
    description: Timeseries of worker_id to job_title.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_id
            - assignment_valid_from
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_id
            - is_first_assignment
          config:
            where: "is_first_assignment = true"
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_id
            - is_current_assignment
          config:
            where: "is_current_assignment = true"
    columns:
      - name: worker_id
        tests:
          - not_null
      - name: assignment_status_reason
        meta:
          masking_policy: dei_string
      - name: assignment_valid_from
        tests:
          - not_null

  - name: stg_adp__worker_assigned_organizational_units
    description: Work assignment mapping to business units.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - organizational_unit_id
            - worker_assignment_id
            - worker_id
  - name: stg_adp__worker_reports_to
    description: >
      A timeseries of worker to manager mapping. One record per
      worker_assignment_id per timeframe. Snapshotting of this dataset began
      January 15, 2023.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_assignment_id
            - reports_to_worker_id
            - reports_to_valid_from
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_assignment_id
            - is_first_reports_to
          config:
            where: "is_first_reports_to = true"
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - worker_assignment_id
            - is_current_reports_to
          config:
            where: "is_current_reports_to = true"
    columns:
      - name: worker_assignment_id
        description: > 
          Unique identifier of a specific task or job that an employee is assigned to complete. 
          This could include anything from a short-term project to an ongoing role within the company 
          â€“ the latter being the case used by dbt Labs.
        tests:
          - not_null
      - name: worker_id
        description: Unique identifier of a dbt Labs employee attributed by ADP
        tests:
          - not_null
      - name: reports_to_worker_id
        description: Worker identifier of the direct manager of the employee, as attributed by ADP
        tests:
          - not_null
      - name: is_first_reports_to
        description: Boolean indicating first direct manager for the employee
      - name: is_current_reports_to
        description: Boolean indicating current direct manager for the employee
      - name: reports_to_valid_from
        description: Date from which the reporting is valid
        tests:
          - not_null
      - name: reports_to_valid_to
        description: Date until which the reporting is valid

  - name: stg_adp__workers
    columns:
      - name: worker_id
        tests:
          - not_null
          - unique
      - name: worker_status
        tests:
          - accepted_values:
              values: ['Active', 'Terminated']
  - name: stg_adp__locations
    description: Worker Postal Code and Country Code Mapping
    columns:
      - name: location_id
        tests:
          - not_null
          - unique
  - name: stg_adp__worker_assigned_locations
    description: Worker Postal Code and Country Code Mapping
    columns:
      - name: worker_assignment_id
        tests:
          - not_null
          - unique
  - name: stg_adp__classifications
    description: EEO classification ID to value mapping
    columns:
      - name: classification_id
        tests:
          - not_null
          - unique
  - name: stg_adp__worker_classifications
    description: Classification ID to work assignement ID mapping
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - classification_id
            - worker_assignment_id
            - worker_id
    columns:
      - name: classification_id
        tests:
          - not_null