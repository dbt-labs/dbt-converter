version: 2

models:

  - name: stg_lever__applications
    description: The applications to a job posting.
    columns:
      - name: application_id
        tests:
          - unique
          - not_null

  - name: stg_lever__archive_reasons
    columns:
      - name: archive_reason_id
        tests:
          - unique
          - not_null

  - name: stg_lever__opportunities
    description: When someone applies to a job posting, they are then populated as an opportunity. To query the all opportunities in Lever and their current statuses (with enriched fields), we suggest using `fct_hiring_opportunities`.
    columns:
      - name: opportunity_id
        tests:
          - unique
          - not_null
      - name: current_stage_name
        description: The current stage that the opportunity is in. If they were archived (either hired or did not move on) then this will be `Archived` or `Hired`.
      - name: stage_name_before_archived
        description: If an opportunity was archived (either hired or did not move on), then this shows the last stage they were in before they were archived.
      - name: days_since_last_interaction
        description: If an opportunity is not archived, then this looks at how long it has been since a dbt Labs team member has last interacted with them.
      - name: days_in_pipeline
        description: This measures how many days an opportunity was in the pipeline. If they are not archived, then this will continue to increase until they are archived.

  - name: stg_lever__opportunity_stage_history
    description: The history of an opportunity and their stages in the hiring pipeline.
    columns:
      - name: opportunity_history_id
        description: This is a surrogate key between `opportunity_id`, `stage_id`, and `updated_at` as an opportunity can move back and forth between stages (particularly the offer stage).
        tests:
          - unique
          - not_null
      - name: updater_id
        description: The dbt Labs member who updated the opportunity (i.e. the Lever `user_id`)
      - name: to_stage_index
        description: The stage number that the opportunity was moved into.

  - name: stg_lever__postings
    columns:
      - name: posting_id
        tests:
          - unique
          - not_null

  - name: stg_lever__requisition_postings
    columns:
      - name: requisition_posting_id
        tests:
          - unique
          - not_null

  - name: stg_lever__requisitions
    description: >
      Requisitions = one seat to be hired. This model also removes any deleted requisitions.
      To see all requisitions, you can query the `base__lever_requisitions` model.
    columns:
      - name: requisition_id
        tests:
          - unique
          - not_null

  - name: stg_lever__stages
    columns:
      - name: stage_id
        tests:
          - unique
          - not_null
      - name: stage_name
        tests:
          - accepted_values:
              name: accepted_values_stg_lever__stages_stage_name__custom_stages
              values:
                - New Lead
                - Reached Out
                - Responded
                - New Applicant
                - Reviewed
                - TA Interview
                - Hiring Manager Interview
                - Task
                - Technical Interview
                - Panel Round Interview
                - Final Interview
                - Background Check
                - Reference Check
                - Offer
                - Check-In Call
      - name: stage_bucketed
        description: '{{ doc("lever_stage_bucketed") }}'
      - name: stage_pipeline
        description: '{{ doc("lever_stage_pipeline") }}'
      - name: stage_index
        description: '{{ doc("lever_stage_index") }}'
      - name: stage_bucketed_index
        description: '{{ doc("lever_stage_bucketed_index") }}'

  - name: stg_lever__users
    columns:
      - name: user_id
        tests:
          - unique
          - not_null