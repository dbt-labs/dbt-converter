version: 2

metrics:
  - name: base__promoters_pct
    label: (Base) Percent Promoters (Cloud)
    description: >
      'The percent of dbt Cloud users in the promoters segment.'
    tags: []

    calculation_method: derived
    expression: "{{metric('base__count_nps_promoters_cloud')}} / {{metric('total_nps_respondents_cloud')}}" 

    timestamp: created_at
    time_grains: [day, month, quarter, year]

    dimensions:
      - nps_category
      - account_plan

    meta:
      metric_level: 'Company'
      owner(s): 'Andrew Tom'


  - name: base__detractors_pct
    label: (Base) Percent Detractors (Cloud)
    description: >
      'The percent of dbt Cloud users in the detractors segment.'
    tags: []

    calculation_method: derived
    expression: "{{metric('base__count_nps_detracters_cloud')}} / {{metric('total_nps_respondents_cloud')}}" 

    timestamp: created_at
    time_grains: [day, month, quarter, year]

    dimensions:
      - nps_category
      - account_plan

    meta:
      metric_level: 'Company'
      owner(s): 'Andrew Tom'


  - name: nps_cloud
    label: Net Promoter Score (Cloud)
    description: >
      'The NPS (-1 to 1) of all dbt Cloud users.'
    tags: ['Company Metric', 'FY2024 - O2']

    calculation_method: derived
    expression: "{{metric('base__promoters_pct')}} - {{metric('base__detractors_pct')}}"

    timestamp: created_at
    time_grains: [day, month, quarter, year]

    dimensions:
      - nps_category
      - account_plan

    meta:
      metric_level: 'Company'
      owner(s): 'Andrew Tom'