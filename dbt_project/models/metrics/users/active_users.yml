version: 2

metrics:
  - name: active_cloud_users
    label: Active Users
    model: ref('fct_cloud_user_account_activities')
    description: >
      'The sum total of dbt Cloud users that logged in and
      interacted with at least one feature during the specified time grain.'
    tags: []

    calculation_method: count_distinct
    expression: user_id

    filters:
      - field: is_active
        operator: "="
        value: "1"

    timestamp: date_day
    time_grains: [day, week, month, quarter, year]

    #dimensions:
      # future dimension: user_region (map down from account level)
      # future dimension: product_feature

    meta:
      metric_level: 'Company'
      owner(s): 'Andrew Tom'


  - name: weekly_active_cloud_users
    label: Cumulative Weekly Active Cloud Users
    model: ref('fct_cloud_user_account_activities')
    description: >
      'The sum total of dbt Cloud users that logged in and interacted
      with at least one feature in the last trailing 7 days.'
    tags: ['Company Metric']

    calculation_method: sum
    expression: t7d_active

    timestamp: date_day
    time_grains: [day]

    meta:
      metric_level: 'Company'
      owner(s): 'Andrew Tom'


  - name: active_cloud_ide_users
    label: Cumulative Active IDE Users
    model: ref('fct_cloud_user_account_activities')
    description: >
      'The sum total of dbt Cloud users that logged in and interacted
       with the ide for at least 10 min in the last trailing 7 days.'
    tags: ['Core Metric']

    calculation_method: sum
    expression: t7d_ide_active
    # use where logic to filter on `is_ide_engaged_for_10min` = 1

    timestamp: date_day
    time_grains: [day]

    meta:
      metric_level: 'Company'
      owner(s): 'Andrew Tom'