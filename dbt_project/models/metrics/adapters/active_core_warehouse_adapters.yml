version: 2

metrics:
  - name: active_core_warehouse_adapters
    label: Active Warehouse Adapters (Core)
    model: ref('fct_dbt_invocations')
    description: > 
      A measure of engaged activity originating from a unique data platform, defined 
      as whether the adapter had an invocation in dbt Core during the specified time grain.
      A core active adapter may also be cloud active (not mutually exclusive).
    tags: []

    calculation_method: count_distinct
    expression: >
      case when develop_request_id is NULL then adapter_unique_id
      when run_id is NULL then adapter_unique_id else NULL end

    timestamp: started_at
    time_grains: [day, week, month, quarter, year]

    dimensions:
      - adapter
      - adapter_unique_id
      - plan

    filters:
      - field: run_id
        operator: "is"
        value: "null"
      - field: develop_request_id
        operator: "is"
        value: "null"

    meta:
      metric_level: 'Company'
      owner(s): 'Andrew Tom'