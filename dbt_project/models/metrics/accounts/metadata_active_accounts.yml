version: 2

metrics:
  - name: metadata_active_accounts
    label: Active Cloud Accounts Metadata API
    model: ref('metadata_daily_user_activity')
    description: "The count of all distinct Cloud accounts using the Metadata API."
    tags: ['Product Metric']

    calculation_method: count_distinct
    expression: account_id

    timestamp: event_date
    time_grains: [day, week, month]

    dimensions:
        - account_id

    filters:
        - field: total_metadata_api_requests
          operator: '>'
          value: '0'


  - name: external_metadata_active_accounts
    label: Active Cloud Accounts Metadata API External
    model: ref('metadata_daily_user_activity')
    description: "The count of all distinct Cloud accounts using the Metadata API externally."
    tags: ['Product Metric']

    calculation_method: count_distinct
    expression: account_id

    timestamp: event_date
    time_grains: [day, week, month]

    dimensions:
        - account_id

    filters:
        - field: total_external_metadata_api_requests
          operator: '>'
          value: '0'

  - name: metadata_API_requests
    label: Metadata API Requests
    model: ref('metadata_daily_user_activity')
    description: "The sum of all Metadata API requests."
    tags: ['Product Metric']

    calculation_method: sum
    expression: total_metadata_api_requests

    timestamp: event_date
    time_grains: [day, week, month]

    dimensions:
        - account_id
        - source_count