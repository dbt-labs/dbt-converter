version: 2

metrics:
  - name: semantic_layer_enabled_accounts
    label: Accounts with Semantic Layer Environment Enabled
    model: ref('fct_cloud_accounts')
    description: "The sum of all active dbt Cloud accounts with the Semantic Layer enabled in their environment."
    tags: ['Product Metric']

    calculation_method: count_distinct
    expression: account_id

    timestamp: last_successful_run_at
    time_grains: [week, month]

    dimensions:
      - name
      - plan
      - account_id
      - has_metrics
      - has_successful_semantic_layer_run
      - last_successful_run_at
      - last_metadata_api_request_at

    filters:
        - field: has_successful_semantic_layer_run
          operator: '='
          value: '1'
        - field: is_primary_cloud_account 
          operator: '='
          value: 'true'
        - field: is_partner_training_acct
          operator: '='
          value: 'false'

    meta:
      metric_level: 'Product'
      owner: 'Cameron Afzal'